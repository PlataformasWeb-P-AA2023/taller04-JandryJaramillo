<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Demo jQuery - jQueryUI - CouchDB</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  </head>
  <body>
    
      <h3>Taller 4</h3>
      <div id="pestanias">
        
        <div id="t1">
          <p id="mensajeFinal"></p>
          <button id="bt1" type="submit">all información</button>          
        </div>

        <div id="t2">
          <p id="mensajeFinal"></p>
          <input type="text" id="canton" name="canton">
          <button id="bt2" type="submit">buscar por cantón</button>          
        </div>

      </div>
  </body>
  <script>
    $(document).ready(function() {
      

      $( "#bt1" ).click(function() {
        $.ajax({
              dataType: 'json',
              url: "http://127.0.0.1:5984/instituciones/_design/vista1/_view/vista001?include_docs=true"
              }).then(function(data) {
                console.log(data);
                for(var i=0; i<data.rows.length; i++){
                  var amie = data.rows[i].doc.AMIE;
                  var name = data.rows[i].doc.Nombre_Institucion;
                  var prov = data.rows[i].doc.Provincia;
                  var cprov = data.rows[i].doc.Codigo_Provincia;
                  var ccan = data.rows[i].doc.Codigo_Canton;
                  var can = data.rows[i].doc.Canton;
                  var cpar = data.rows[i].doc.Codigo_Parroquia;
                  var par = data.rows[i].doc.Parroquia;
                  var za = data.rows[i].doc.Zona_Administrativa;
                  $('#mensajeFinal').append("<p> <b>AMIE:</b> "+ amie + " <b>Nombre de la institución:</b> " +
                    name + " <b>Provincia:</b> " +
                    prov + " <b>Código Provincia:</b> " +
                    cprov + " <b>Código Canton:</b> " +
                    ccan + " <b>Canton:</b> " +
                    can +" <b>Código Parroquia:</b> " +
                    cpar +" <b>Parroquia:</b> " +
                    par +" <b>Zona Administrativa:</b> " +
                    za +"</p>");
                }
              });
      });

      $( "#bt2" ).click(function() {
        var canton = $('#canton').val();
        var urls = 'http://127.0.0.1:5984/instituciones/_design/vista1/_view/vista001?key="'+canton+'"';
        console.log(urls);

        console.log(canton);
        $.ajax({

              dataType: 'json',
              url:     urls
                        }).then(function(data) {
                console.log(data);
                for(var i=0; i<data.rows.length; i++){
                  var amie = data.rows[i].doc.AMIE;
                  var name = data.rows[i].doc.Nombre_Institucion;
                  var prov = data.rows[i].doc.Provincia;
                  var cprov = data.rows[i].doc.Codigo_Provincia;
                  var ccan = data.rows[i].doc.Codigo_Canton;
                  var can = data.rows[i].doc.Canton;
                  var cpar = data.rows[i].doc.Codigo_Parroquia;
                  var par = data.rows[i].doc.Parroquia;
                  var za = data.rows[i].doc.Zona_Administrativa;
                  $('#mensajeFinal').append("<p> <b>AMIE:</b> "+ amie + " <b>Nombre de la institución:</b> " +
                    name + " <b>Provincia:</b> " +
                    prov + " <b>Código Provincia:</b> " +
                    cprov + " <b>Código Canton:</b> " +
                    ccan + " <b>Canton:</b> " +
                    can +" <b>Código Parroquia:</b> " +
                    cpar +" <b>Parroquia:</b> " +
                    par +" <b>Zona Administrativa:</b> " +
                    za +"</p>");
                }
              });
      });

    });
  </script>
</html>
